# Thanks to Tyson https://github.com/tyson-swetnam
Bootstrap: docker
From: nvcr.io/nvidia/pytorch:19.06-py3
# changed to latest version with drivers compatible on my machine
# https://docs.nvidia.com/deeplearning/dgx/pytorch-release-notes/rel_18.08.html#rel_18.08 

%post
# Install dependencies
   export DEBIAN_FRONTEND="noninteractive"
   # Linux Depends
   apt-get update
   # conda installs
   /opt/conda/bin/conda install -c fastai fastai
   /opt/conda/bin/conda install -y -c conda-forge opencv imageio h5py fire
   # clean up reduce space
   apt-get autoremove -y
   apt-get clean

%runscript

     echo "Starting notebook..."
     echo "Open browser to localhost:8888"
     exec jupyter notebook --notebook-dir=/opt/notebooks --ip='calliope.cyverse.org' --allow-root --port=8888 --no-browser
